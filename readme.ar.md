# I18n
[[English]](readme.md)

مكتبة لتمكين ترجمة النصوص المستخدمة في واجهات المستخدم. هذه المكتبة تحمل الترجمات من ملفات PO.

## الاستخدام

* أضف المكتبة إلى المشروع باستخدام مدير حزم الأسس:

<div dir=rtl>

```
اشمل "مـحا"؛
مـحا.اشمل_ملف("Alusus/I18n"، "تـرجمة.أسس")؛
```

</div>

```
import "Apm";
Apm.importFile("Alusus/I18n");
```

* هيئ المكتبة:

<div dir=rtl>

```
تـرجمة.هيئ_النصوص()؛
```

</div>

```
I18n.initializeStrings();
```


* اضف ملف ليتم استخدامه في الترجمة:

<div dir=rtl>

```
تـرجمة.اضف_النصوص(محتوى_po)؛
```

</div>

```
I18n.addStrings(poContent);
```

أو

<div dir=rtl>

```
تـرجمة.اضف_النصوص(مـتم.نـم.اقرأ_ملف("en.po"))؛
```

</div>

```
I18n.addStrings(Srl.Fs.readFile("lang.po"));
```

* استبدل سلاسل المحارف المضمنة بالدالة `تـرجمة.نص`:

<div dir=rtl>

```
طـرفية.اطبع(تـرجمة.نص("نصي المترجم"))؛
```

</div>

```
Console.print(I18n.string("My localized string"));
```

## معرفة اتجاه اللغة

لمعرفة اتجاه اللغة، اي معرفة إن كانت تكتب من اليمين أو اليسار، نستخدم دالة `هل_اللغة_يمينية` (`isRightToLeft`):

<div dir=rtl>

```
تـرجمة.هل_اللغة_يمينية(نـص("ar")) // ترجع 1
تـرجمة.هل_اللغة_يمينية(نـص("ar_EG")) // ترجع 1
تـرجمة.هل_اللغة_يمينية(نـص("en")) // ترجع 0
```

</div>

```
I18n.isRightToLeft(String("ar")) // returns true
I18n.isRightToLeft(String("ar_EG")) // returns true
I18n.isRightToLeft(String("en")) // returns false
```

## صنف مـوارد_نصية (TextAssets)

يمكّنك هذا الصنف من تحميل ملفات نصية بعدة لغات من مجلد وتوفيرها تلقائيا كصنف يحتوي خصلة نصية لكل من
هذه الملفات، ثم يحملها لك تلقائيا مقسمة إلى لغات حسب المجلدات المتوفرة. يستقبل هذا الصنف القالب
معطيين، أحدهما مسار مجلد الموارد النصية والآخر اللغة المبدئية، ويطلب أن يحتوي مجلد الموارد النصية
على مجلد لكل لغة برمز اللغة كاسم الجلد، وفي كل من هذه المجلدات توضع الملفات النصية بنفس الأسماء لكل
اللغات. سيعرف الصنف متغيرا لكل من هذه الملفات وسيَحمل المتغير اسم الملف بدون الامتداد.

**ملاحظة:**
هذا الصنف سيحمل الموارد كلها ولكل اللغات أثناء الترجمة وليس أثناء التنفيذ، ما يتيح استخدامه لترجمة
واجهات المستخدم في تطيبقات الويب.

على سبيل المثال، إذا كان لديك المجلد التالي:

```
assets/
  en/
    file1.txt
    file2.txt
    strings.po
  ar/
    file1.txt
    file2.txt
    strings.po
```

فبعد تهيئة الصنف سيكون لديك صنف يحتوي على `تـطبيق` (`Map`) فيه مفتاحين: ar و en، ولكل مفتاح نموذج من
الصنف. والصنف في هذه الحالة سيحتوي على ثلاثة متغيرات من صنف `نـص` (`String`) وهي: file1 و file2
و strings.

لتهيئة واستخدام الصنف:

<div dir=rtl>

```
تـرجمة.مـوارد_نصية["./الموارد_النصية"، "ar"].هيئ()؛
تـرجمة.مـوارد_نصية["./الموارد_النصية"، "ar"].حدد_اللغة_الحالية(اللغة_الحالية)؛
عرف النصوص: نـص = تـرجمة.مـوارد_نصية["./الموارد_النصية"، "ar"].الحالي.النصوص؛
تـرجمة.هيئ_النصوص(النصوص)؛
طـرفية.اطبع("%s\ج"، تـرجمة.نص("مثال نصي"))؛
```

</div>

```
I18n.TextAssets["./text_assets", "en"].initialize();
I18n.TextAssets["./text_assets", "en"].setCurrentLanguage(currentLang);
def strings: String = I18n.TextAssets["./text_assets", "en"].current.strings;
I18n.initializeStrings(strings);
Console.print("%s\n", I18n.string("string example"));
```

يمكن الوصول إلى رمز اللغة الحالية باستخدام المتغير `اللغة_الحالية` (`currentLanguage`). يفضل الاعتماد
على هذا المتغير لأنه يضمن عدم استخدام لغة غير متوفرة ضمن الترجمات الحالية. مثلا، لو استدعيت دالة
`حدد_اللغة_الحالية` (`setCurrentLanguage`) برمز لغة غير متوفر ضمن الترجمات فإن الصنف سيختار اللغة
المبدئية بدل اختيار لغة لا ترجمة لها.

### مـوارد_نصية.هات_اللغات_المتوفرة (TextAssets.getAvailableLanguages)

ترجع هذه الدالة قائمة باللغات المتوفرة. يجب أن تُستدعى دالة `هيئ` (`initialize`) قبل استدعاء هذه
الدالة. تحرص هذه الدالة على وضع اللغة المبدئية في مقدمة المصفوفة المرجعة.

<div dir=rtl>

```
دالة هات_اللغات_المتوفرة(): مـصفوفة[نـص]؛
```

</div>

```
func getAvailableLanguages(): Array[String];
```


